{% extends 'base.html' %}
{% load static %}

{% block head %}
  {% comment %} Link CSS file {% endcomment %}
  <script src="{% static 'js/investment-calculator.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
{% endblock %}

{% block content %}

<section class="page-header">
  <h1>Investments</h1>
</section>
  <h2>Total Amount Spent Yearly: ${{yearly_price}}</h2>
  <h2>Total Amount Spent Monthly: ${{monthly_price}}</h2>

    <div class="jumbotron">
    <h1 class="text-center display-4">JavaScript Interest Calculator</h1>
    <hr>
    <div class="container" id="simple-interest">
      <h3>Simple Interest</h3>
      <p class="lead">A=i+(prt)</p>
      <form id="siForm">
        <div class="form-group">
          <label for="principalSimple">Principal</label>
          <input type="text" class="form-control" id="principalSimple" placeholder="Enter amount without dollar sign" value="{{yearly_price}}">
        </div>
        <div class="form-group">
          <label for="interestSimple">Interest Rate</label>
          <input type="text" class="form-control" id="interestSimple" placeholder="Example: 12%">
        </div>
        <div class="form-group">
          <label for="termSimple">Term of Loan</label>
          <input type="text" class="form-control" id="termSimple" placeholder="Years">
        </div>
        <button type="button" class="btn btn-primary" id="btnSimple" onClick="changeGraph()">Submit</button>
      </form>
      <div>
        <p class="lead mt-3" id="siOutput-01"></p>
        <p class="lead mb-3" id="siOutput-02"></p>
      </div>
      <div class="text-center">
        <input class="btn btn-secondary btn-lg" type="button" value="Reset" onClick="document.getElementById('siForm').reset()">
      </div>
    </div>
    <br>
    <hr>
    <br>
    <div class="container" div="compound-interest ">
      <h3>Compound Interest</h3>
      <p class="lead">A=p(1+(r/n))^(nt)</p>
      <form id="ciForm">
        <div class="form-group">
          <label for="principalCompound">Principal</label>
          <input type="text" class="form-control" id="principalCompound" placeholder="Enter amount without dollar sign" value="{{yearly_price}}">
        </div>
        <div class="form-group">
          <label for="interestCompound">Interest Rate</label>
          <input type="text" class="form-control" id="interestCompound" placeholder="Example: 12%">
        </div>
        <div class="form-group">
          <label for="timesCompounded">Times Compounded per Year</label>
          <input type="text" class="form-control" id="timesCompounded" placeholder="Example: 4 (means compounded quarterly)">
        </div>
        <div class="form-group">
          <label for="termCompound">Term of Loan</label>
          <input type="text" class="form-control" id="termCompound" placeholder="Example: 2 (must be in terms of years)">
        </div>
        <button type="submit" class="btn btn-primary" id="btnCompound" onclick="compoundInterest()">Submit</button>
      </form>
      <div>
        <p class="lead mt-3" id="ciOutput-01"></p>
        <p class="lead mb-3" id="ciOutput-02"></p>
      </div>
      <div class="text-center">
        <input class="btn btn-secondary btn-lg" type="button" value="Reset" onClick="document.getElementById('ciForm').reset()">
      </div>
    </div>
  </div>

  <div>
    <canvas id="myChart" width="380" height="200"></canvas>
    <script>

      var ctx = document.getElementById('myChart').getContext('2d');
      var chartData = []
      //var chartLabels
      var myChart = new Chart(ctx, {
          type: 'line',
          data: {
              labels: ['2021', '2022', '2023', '2024', '2025', '2026'],
              datasets: [{
                  label: 'Investment Over Time',
                  backgroundColor: 'rgb(0,214,75, 0.2)',
                  data: [],
                  fill: true,
                  borderColor: 'rgb(0,214,75)',
                  tension: 0.1,
              }]
          },
          options: {
              scales: {
                  y: {
                      beginAtZero: true,
                      ticks: {
                        precision: 0
                      }
                  }
              }
          }
      });

      const buttonSimple = document.getElementById("btnSimple")
      const term = document.getElementById("termSimple")
      //buttonSimple.addEventListener('click', changeGraph())

      console.log(term.value)

      function changeGraph() {
        simpleInterest()

        console.log(myChart.config.data.labels)
        let yearLabels = []
        let currentYear = parseInt(new Date().getFullYear())
        for (let i=0; i <= term.value; i++) {
          yearLabels.push(currentYear)
          currentYear++
        }
        myChart.data.datasets[0].data = simpleInterestByYear
        myChart.config.data.labels = yearLabels
        myChart.update()

        console.log(`dataset data ${myChart.data.datasets[0].data}`)
      }
    </script>
  </div>
{% endblock %}